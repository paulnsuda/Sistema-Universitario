// prisma/usuarios/schema.prisma

generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/@prisma/client-usuarios" 
  // Usa "../" porque el archivo está dentro de la carpeta 'prisma'
}

datasource db {
  provider = "postgresql"

}

model Usuario {
  id_usuario       Int       @id @default(autoincrement())
  nombres          String
  apellidos        String
  cedula           String    @unique
  email            String    @unique
  password         String    @db.VarChar(255)
  fecha_nacimiento DateTime? @db.Date
  
  // Relaciones Locales
  id_rol           Int
  rol              Rol       @relation(fields: [id_rol], references: [id_rol])

  inscripciones    Inscripcion[]

  @@map("usuarios")
}

model Rol {
  id_rol      Int          @id @default(autoincrement())
  nombre_rol  String       @unique // Ej: "Admin", "Estudiante", "Profesor"
  
  usuarios    Usuario[]
  permisos    RolPermiso[]

  @@map("roles")
}

model Permiso {
  id_permiso     Int          @id @default(autoincrement())
  nombre_permiso String       @unique 
  clave          String       @unique // Ej: "CREAR_MATERIA"
  
  roles          RolPermiso[]

  @@map("permisos")
}

model RolPermiso {
  id_rol     Int
  id_permiso Int
  
  rol        Rol     @relation(fields: [id_rol], references: [id_rol])
  permiso    Permiso @relation(fields: [id_permiso], references: [id_permiso])

  @@id([id_rol, id_permiso])
  @@map("roles_permisos")
}

model Inscripcion {
  id_inscripcion     Int      @id @default(autoincrement())
  fecha_inscripcion  DateTime @default(now())
  calificacion_final Decimal? @db.Decimal(4, 2)

  // Relación Local (Usuario sí existe en esta DB)
  id_usuario         Int
  usuario            Usuario  @relation(fields: [id_usuario], references: [id_usuario])
  
  // RELACIONES EXTERNAS (Apuntan a la DB de Carreras):
  // Guardamos solo los IDs. La validación se hace en el Service.
  id_materia         Int
  id_ciclo           Int

  @@map("inscripciones")
}